@using DeerskinSimulation.Resources
@using DeerskinSimulation.ViewModels
@using DeerskinSimulation.Models
@using DeerskinSimulation.Components
@inject IJSRuntime JS

@code {
    [Parameter] public List<EventResult> Events { get; set; }
    [Parameter] public string? ImageUrl { get; set; }
    [Parameter] public string? ImageCaption { get; set; }

    private MessageConsoleViewModel viewModel = new MessageConsoleViewModel();

    protected override void OnInitialized()
    {
        base.OnInitialized();

        viewModel.ImageUrl = ImageUrl ?? "images/ph_256.jpg";
        viewModel.ImageCaption = ImageCaption ?? "The Deerskin Economy";
    }
}

<div class="col-md-4">
    <div class="card mb-4">
        <div class="card-header">
            <h4>@UIStr.ImageTitle</h4>
        </div>
        <div class="card-body">
            <figure class="text-center">
                <img class="img-fluid" src="@viewModel.ImageUrl" alt="Event Image" width="256" />
                <figcaption class="mt-2">@viewModel.ImageCaption</figcaption>
            </figure>
            <p>
                During the 1700s, millions of white-tail deerskins played a vital role in the colonial economy. These skins were skinned, scraped, and packed by hand, primarily by Native Americans and frontier settlers. They were then carried over mountains by horseback and transported to port by wagon. Once at the port, they were shipped across the Atlantic to European tanneries. In Europe, the deerskins were highly valued for their quality and used to produce fine leather goods, fueling a lucrative transatlantic trade.
            </p>
        </div>
    </div>
</div>

<div class="col-md-4">
    <div class="card mb-4">
        <div class="card-header">
            <h4>@UIStr.MessagesTitle</h4>
        </div>
        <div class="card-body">
            <div id="console" style="height: 200px; overflow-y: scroll; border: 1px solid #8b4513; padding: 10px;">
                @if (Events?.Any() == true)
                {
                    int? last = null;
                    @foreach (var e in Events.Reverse<EventResult>())
                    {
                        @if (last != @e.Meta?.ActivityElapsed)
                        {
                            last = e.Meta?.ActivityElapsed;
                            @if (@e.Meta?.ActivityName != null)
                            {
                                <span>@e.Meta?.ActivityName Day @last</span>
                            }
                            else
                            {
                                <span>Day @last</span>
                            }
                        }   
                        @foreach (var msg in e.Records.Reverse<EventRecord>())
                        {
                            viewModel.ImageUrl = msg.Image;
                            viewModel.ImageCaption = msg.Message;
                            <MessageConsoleLineItem Message="msg" />
                        }
                    }
                }
                else
                {
                    <p>@UIStr.NoMessagesLabel</p>
                }
            </div>
        </div>
    </div>
</div>
